<app-sidebar></app-sidebar> 

<div class="container-fluid" style="margin-left: 250px; max-width: 1100px;">
  
  <div class="d-flex flex-wrap justify-content-start mb-2" style="max-width: 1080px;">

    <div class="card summary-card ms-2 me-2">
      <div class="card-header bg-success text-center">
        <strong class="fs-4"><i class="fa fa-money-bill"></i> Sales</strong>
      </div>
      <div class="card-body bg-light text-center">
        <h5>Amount: <br><br> <strong class="text-success">{{ totalSalesAmount | currency:'Kes.' }}</strong></h5>
      </div>
      
    </div>

    <div class="card summary-card me-2">
      <div class="card-header bg-success text-center">
        <strong class="fs-4"><i class="fa fa-bomb"></i> Expenses</strong>
      </div>
      <div class="card-body bg-light text-center">
        <h5>Amount: <br> <br> <strong class="text-danger">{{ totalExpensesAmount | currency:'Kes.' }}</strong></h5>
      </div>
    </div>

    <div class="card summary-card me-2">
      <div class="card-header bg-success text-center">
        <strong class="fs-4"><i class="fa fa-list"></i> Profit</strong>
      </div>
      <div class="card-body bg-light text-center">
        <h5>Profit Accumulated: <br><br> <strong class="text-success">{{ totalSalesAmount - totalExpensesAmount | currency:'Kes.' }}</strong></h5>
      </div>
    </div>

    <div class="card summary-card">
      <div class="card-header bg-success text-center">
        <strong class="fs-4"><i class="fa fa-dove"></i> Total Birds</strong>
      </div>
      <div class="card-body bg-light text-center">
        <h5>Breed/Type: Sasso</h5>
        <h5 class="mt-4"><strong>No: {{ effectiveTotalBirds }} <i class="fa fa-check-to-slot text-success"></i></strong></h5>
      </div>
    </div>
  </div>

  <div class="text-success" style="max-width: 1075px;">
    <hr>
  </div>

  <div class="container-fluid mt-4">
    <div class="d-flex align-items-center mb-2" style="max-width: 1080px;height: 34px;">
      <h3 class="text-success fw-bold mt-2">Financial Overview</h3>
  
      <div class="d-flex ms-auto">
        <select [(ngModel)]="selectedYear" (change)="onYearChange()" class="form-select me-2">
          <option *ngFor="let year of years" [value]="year">{{ year }}</option>
        </select>        
        <select [(ngModel)]="selectedMonth" class="form-select me-5">
          <option value="" style="background-color:green;">All Months</option>
          <option *ngFor="let month of months" [value]="month">{{ month }}</option>
        </select>
        <button (click)="printMonthlyRecords()" class="btn btn-success me-3" style="width: 100px;height: 40px;">
          <i class="fa fa-print"></i> Print Records
        </button>
      </div>
    </div>
  
    <div class="table-responsive shadow-sm rounded" style="max-width: 1075px;">
      <table class="table table-hover table-bordered">
        <thead class="bg-success text-light">
          <tr>
            <th>Month</th>
            <th>Total Sales (Kes.)</th>
            <th>Total Expenditure (Kes.)</th>
            <th>Profit (Kes.)</th>
          </tr>
        </thead>

        <tbody *ngIf="!noDataForYear; else noDataTemplate">
          <tr *ngFor="let month of getFilteredMonthlyRecords() | slice: (currentPage - 1) * itemsPerPage : currentPage * itemsPerPage; let i = index">
            <td>{{ month }} {{ selectedYear }}</td>
            <td>{{ monthlySales[getMonthIndex(month) + 1] || 0 | currency: 'Kes.' }}</td>
            <td>{{ monthlyExpenses[getMonthIndex(month) + 1] || 0 | currency: 'Kes.' }}</td>
            <td [ngClass]="{
                'text-success': (monthlySales[getMonthIndex(month) + 1] || 0) - (monthlyExpenses[getMonthIndex(month) + 1] || 0) > 0,
                'text-danger': (monthlySales[getMonthIndex(month) + 1] || 0) - (monthlyExpenses[getMonthIndex(month) + 1] || 0) <= 0
              }">
              {{ (monthlySales[getMonthIndex(month) + 1] || 0) - (monthlyExpenses[getMonthIndex(month) + 1] || 0) | currency: 'Kes.' }}
            </td>
          </tr>
        </tbody>
        
        <ng-template #noDataTemplate>
          <tr>
            <td colspan="4" class="text-center text-muted">No data record for this year</td>
          </tr>
        </ng-template>
        
      </table>
    </div>
  
    <div class="pagination-controls mt-3 d-flex align-items-center">
      <button class="btn btn-outline-success bg-success text-light" (click)="previousPage()" [disabled]="currentPage === 1" style="margin-left: 40%;">Previous</button>
      <span>Page {{ currentPage }} of {{ totalPages }}</span>
      <button class="btn btn-outline-success bg-success text-light" (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
    </div>
  </div>
</div>
