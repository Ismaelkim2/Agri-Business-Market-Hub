<app-header></app-header>
<div class="container-fluid" style="margin-top: 80px;">
  <div class="row justify-content-center mt-5">
    <div class="col-lg-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex align-items-center mb-3">

            <!-- <div *ngFor="let user of user">
              <div>
              <ng-container *ngIf="user.userImageUrl; else defaultImage">
                <img [src]="'http://localhost:8081/uploads/' + user.userImageUrl.replace('\\', '/')"
                     alt="User Photo"
                     class="user-photo"
                     style="height: 50px; width: 50px; border-radius: 50%; margin-right: 10px;">
              </ng-container>
              </div>
            
              <ng-template #defaultImage>
                <i class="fa fa-image" style="font-size: 50px; color: #ccc; margin-right: 10px;"></i>
              </ng-template>
              </div> -->
           
              <div *ngIf="loggedInUser">
                <ng-container *ngIf="loggedInUser.userImageUrl; else defaultImage">
                  <img [src]="'http://localhost:8081/' + loggedInUser.userImageUrl.replace('\\', '/')"
                       alt="User Photo"
                       class="user-photo"
                       style="height: 50px; width: 50px; border-radius: 50%; margin-right: 10px;">
                </ng-container>
              </div>
              
              <!-- Default image template -->
              <ng-template #defaultImage>
                <i class="fa fa-user" 
                 style="height: 50px; width: 50px; border-radius: 50%; margin-right: 10px;" ></i>
              </ng-template>
              

            <div *ngIf="loggedInUser">
              <strong>{{ loggedInUser.firstName }} {{ loggedInUser.lastName }} <i class="fa fa-regular fa-circle-check text-success bg-green "></i></strong>
            </div> <br>

            <form [formGroup]="formpost" class="flex-grow-1 ms-3" style="margin-left: 12px;width: 100px;">
              <div class="d-flex">
                <div><input type="text" formControlName="postInput" routerLink="/new-post"  class="form-control " placeholder="Post your products here..." style="width: 200px;"></div>
                <div> <button class="btn btn-primary ms-2 mt-2 " routerLink="/new-post" >Post</button> </div>
              </div>
              
            </form>

          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="post-list">
  <div class="updates">
    <div *ngIf="posts.length === 0" class="alert alert-info">No posts found.</div>
  </div>

  <div *ngFor="let post of posts" class="card mb-3">
    <div class="card-body">
      <div class="d-flex align-items-center">


       <!-- Display post creator's image -->
       <div *ngIf="post.userDTO">
        <img [src]="'http://localhost:8081/' + post.userDTO.userImageUrl.replace('\\', '/')"
             alt="User Photo"
             class="user-photo"
             style="height: 50px; width: 50px; border-radius: 50%; margin-right: 10px;">
      </div>

      <ng-template #defaultImage>
        <i class="fa fa-user" 
           style="height: 50px; width: 50px; border-radius: 50%; margin-right: 10px;"></i>
      </ng-template>

        <div class="strong fw-bold ">{{ post.createdBy }} <i class="fa fa-regular fa-circle-check text-success bg-green "></i>
        </div>
      </div>

      <p>Posted:{{ post.relativeCreatedAt }}</p>
      <p class="card-text"><strong>{{ post.title }}</strong></p>
      <p *ngIf="post.age !== undefined"><strong>Age:</strong> {{ post.age }}</p>



      <img *ngIf="post.imageUrl" 
      class="card-img-top" 
      [src]="'http://localhost:8081' + post.imageUrl" 
      alt="Post Image" 
      style="height: 200px; width: 100%;">

      
      <div class="d-flex justify-content-between">
        <p>Likes: {{ post.likes }} | Views: {{ post.views }}</p>
      </div>

      <div class="d-flex justify-content-between w-100">
        <button class="btn btn-outline-primary" (click)="toggleLike(post.id, loggedInUser?.id ?? 0)" title="like">
          <i class="fa fa-thumbs-up"></i> <span>{{ post.likes }}</span> 
        </button>

        <button class="btn btn-outline-danger"  (click)="deletePost(post.id, loggedInUser?.id)" title="delete post">
          <i class="fa fa-trash"></i>
        </button>
   
        <button class="btn btn-outline-primary" (click)="onComment()" title="Message">
          <i class="fa fa-comment"></i>
        </button>

        <button *ngIf="!post.isOwnedByLoggedInUser" 
        (click)="editPost(post)" class="btn btn-outline-warning"
         title="edit">
         <i class="fa fa-pen-to-square"></i></button>
      </div>

      <div  class="mt-2"
      *ngIf="!post.isOwnedByLoggedInUser && messageVisibility" class="alert alert-danger mt-2" >{{message}}</div>

    </div>
  </div>
</div>

<app-footer></app-footer>
