<div class="layout">
    <app-sidebar></app-sidebar>
  
    <div class="main-content container-fluid">
      <div class="navigations d-flex justify-content-between align-items-center position-relative">
        <div (click)="goBack()" class="back-btn">
            <i class="fa fa-arrow-left" title="Back"></i>
        </div>
  
        <button class="btn btn-success add-worker-btn mt-4" data-bs-toggle="collapse" data-bs-target="#addWorkerForm">
            <i class="fa fa-plus"></i> Add Worker
        </button>
      </div>
  
      <div *ngIf="saveSuccess" class="alert alert-success save-message">
          <i class="fa fa-check-circle"></i> Worker details saved successfully!
      </div>
  
      <div id="addWorkerForm" class="collapse card p-4">
          <app-workers-form (workerAdded)="onWorkerAdded($event)"></app-workers-form>
      </div>
  
      <div *ngIf="isEditFormVisible" class="card p-4">
          <h5>Edit Worker Details</h5>
          <form #editForm="ngForm">
              <div class="form-group">
                  <label for="name">Name:</label>
                  <input id="name" [(ngModel)]="editableWorker.name" name="name" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="role">Role:</label>
                  <input id="role" [(ngModel)]="editableWorker.role" name="role" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="salary">Salary:</label>
                  <input id="salary" type="number" [(ngModel)]="editableWorker.salary" name="salary" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="email">Email:</label>
                  <input id="email" type="email" [(ngModel)]="editableWorker.email" name="email" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="phone">Phone:</label>
                  <input id="phone" type="text" [(ngModel)]="editableWorker.phone" name="phone" class="form-control" required />
              </div>
              <div class="form-group">
                  <label for="status">Status:</label>
                  <select id="status" [(ngModel)]="editableWorker.status" name="status" class="form-control">
                      <option value="Active">Active</option>
                      <option value="Inactive">Inactive</option>
                  </select>
              </div>
              <div class="form-group">
                  <label for="image">Worker Image:</label>
                  <input type="file" (change)="onImageFileSelected($event)" name="image" class="form-control" />
              </div>
  
              <div *ngIf="editableWorker.image" class="form-group">
                  <img [src]="editableWorker.image" alt="Current Worker Image" class="worker-image" />
              </div>
  
              <button (click)="onSaveWorkerChanges()" class="btn btn-primary mt-3">Save Changes</button>
          </form>
      </div>
  
      <div class="table-responsive mt-4">
          <table class="table table-bordered worker-table">
              <thead>
                  <tr>
                      <th>Id</th>
                      <th>Image</th>
                      <th>Name</th>
                      <th>Role</th>
                      <th>Salary</th>
                      <th>Email</th>
                      <th>Phone</th>
                      <th>Status</th>
                      <th>Action</th>
                  </tr>
              </thead>
              <tbody>
                  <tr *ngFor="let worker of workers; let i = index">
                      <td>{{ i + 1 }}</td>
                      <td>
                          <ng-container *ngIf="worker.image && isValidImage(worker.image); else defaultImage">
                              <img [src]="worker.image" alt="Worker Image" class="worker-image" (error)="imageError($event)" />
                          </ng-container>
                          <ng-template #defaultImage>
                              <i class="fa fa-user worker-image"></i>
                          </ng-template>
                      </td>
                      <td>{{ worker.name }}</td>
                      <td>{{ worker.role }}</td>
                      <td>{{ worker.salary | currency: "KES" }}</td>
                      <td>{{ worker.email }}</td>
                      <td>{{ worker.phone }}</td>
                      <td>
                          <span [ngClass]="{'text-success': worker.status === 'Active', 'text-danger': worker.status === 'Inactive'}">
                              {{ worker.status || 'Active' }}
                          </span>
                      </td>
                      <td class="operations d-flex">
                          <button class="btn btn-warning btn-sm" (click)="onEditWorker(worker)" title="Edit">
                              <i class="fa fa-edit"></i>
                          </button>
                          <button class="btn btn-danger btn-sm ms-2" (click)="onDeleteWorker(worker.id)" title="Delete">
                              <i class="fa fa-trash"></i>
                          </button>
                      </td>
                  </tr>
              </tbody>
          </table>
      </div>
    </div>
  </div>
  